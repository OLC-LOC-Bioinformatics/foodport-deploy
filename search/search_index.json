{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Homepage","text":"<p>This website contains documentation describing the methods for deploying new applications to the Canadian Food Inspection Agency's (CFIA) FoodPort. In order to access FoodPort, you must be connected to CFIA's network.</p>"},{"location":"build/","title":"Building apps for FoodPort","text":"<p>To build applications for FoodPort, you must have access to the Microsoft Azure FoodPort Portal and have the necessary permissions for creating a new virtual machine (VM) image. Contact Adam Koziol (adam.koziol@inspection.gc.ca) to obtain these necessary permissions.</p>"},{"location":"build/#how-apps-work-on-foodport","title":"How apps work on FoodPort","text":"<p>When a user runs a command on FoodPort (e.g. assembling a bacterial genome), a batch VM is created based upon a pre-existing VM image which contains the necessary software and dependencies for executing this command. If there are any files that are needed as input for the software inside of the batch VM (e.g. <code>.fastq.gz</code>), these are placed inside of a blob container and mounted to the batch VM using BlobFuse. Once mounted, these files are available to be used by the batch VM for processing, analysis, etc. Finally, a Shell command is executed within the batch VM to perform the desired task. All of this happens beneath the FoodPort web interface.</p> <p>Therefore, the requirements for building an application on FoodPort are:</p> <ul> <li>A VM image containing the necessary software and dependencies for executing the desired command(s).</li> <li>A web user interface for users to submit their command(s).</li> </ul>"},{"location":"build/#developing-in-vms","title":"Developing in VMs","text":"<p>To add software and other dependencies to your new VM image, the process is as follows:</p> <ol> <li>Spin up/start a new VM.</li> <li>Connect to the new VM.</li> <li>Install software and other dependencies.</li> <li>Capture the VM as a VM image version.</li> </ol>"},{"location":"build/#spinning-up-a-new-vm","title":"Spinning up a new VM","text":"<p>To spin up/start a new VM:</p> <ol> <li> <p>In the Microsoft Azure FoodPort Portal, navigate to Virtual machines.</p> </li> <li> <p>In the top-left corner of the window, click 'Create' and choose 'Azure virtual machine'.</p> </li> <li> <p>Under the Basics tab, change the following:</p> <ul> <li>Subscription: <code>CFDC-FoodPort-Sub</code></li> <li>Resource group: <code>CFDC-FoodPort-Batch-rg</code></li> <li>Virtual machine name: <code>name_of_new_image</code></li> <li>Region: <code>(Canada) Canada Central</code></li> <li>Image: <code>Ubuntu Server 20.04 LTS - x64 Gen2</code></li> <li>Security type: <code>Standard</code><ul> <li>(The image must be selected first)</li> </ul> </li> <li>Size: <code>Standard_D4ds_v5</code></li> <li>Authentication type: Password<ul> <li>Username: <code>[username]</code></li> <li>Password: <code>password</code></li> </ul> </li> <li>Public inbound ports: <code>None</code></li> </ul> </li> <li> <p>Under the Networking tab, change the following:</p> <ul> <li>Virtual network: <code>CFDC-FoodPort-vnet</code></li> <li>Subnet: <code>CFDC-FoodPort-BatchNodes-snet (10.148.57.32/27)</code></li> <li>Public IP: <code>None</code></li> </ul> </li> <li> <p>Under the Tags tab, change the following:</p> <ul> <li>Name: <code>TechContact</code></li> <li>Value: <code>email_address_of_contact</code></li> </ul> </li> <li> <p>Under the Review + create tab, click 'Create' and wait for the VM image to be created.</p> </li> </ol>"},{"location":"build/#connecting-to-a-new-vm","title":"Connecting to a new VM","text":"<p>If you followed the previous steps, you can click on 'Go to resource' after the VM has started, then:</p> <ol> <li>In the top-left corner of the window, click 'Connect'.</li> <li>A new page will appear. Under the SSH tab, within Step 4, copy the Shell command that will be used to connect to the running VM.<ul> <li>e.g. <code>ssh -i &lt;private key path&gt; username@ip_address</code></li> </ul> </li> <li>Run this command in a UNIX terminal on a machine that's connected to the CFIA network, but omit the <code>-i &lt;private key path&gt;</code> part.<ul> <li>i.e. <code>ssh username@ip_address</code></li> </ul> </li> </ol>"},{"location":"build/#installing-software-and-other-dependencies-in-a-new-vm","title":"Installing software and other dependencies in a new VM","text":"<p>Warning</p> <p>If you connect to the VM within your terminal and then disconnect, the VM will stop, and all changes that you've made to the VM will be lost. Before disconnecting from the VM, remember to capture the VM first to save your changes.</p> <p>Software and other dependencies can be installed in the new VM using normal installation commands (e.g. <code>sudo apt install</code>). When using commands that require SSL certificate verification by default (e.g. <code>wget</code>), you may receive an error because of the CFIA firewall. If you require assistance with this, please contact Adam Koziol (adam.koziol@inspection.gc.ca).</p>"},{"location":"build/#capturing-a-new-vm-as-a-vm-image-version","title":"Capturing a new VM as a VM image version","text":"<p>A running VM can be captured as a new VM image version, which allows the user to save changes that are made to the software environment within the VM for future use after the running VM is shut down.</p> <p>To capture a running VM as a VM image version:</p> <ol> <li> <p>Navigate to Virtual machines, click on the running virtual machine, and go to the 'Overview' section.</p> </li> <li> <p>At the top of the window, click 'Capture'.</p> <p></p> </li> <li> <p>Choose the following:</p> <ul> <li>Subscription: <code>CFDC-FoodPort-Batch-rg</code></li> <li>Share image to Azure compute gallery: 'Yes, share it to a gallery as a VM image version'</li> <li>(Optional) Check 'Automatically delete this virtual machine after creating the image'</li> <li>Target Azure compute gallery: <code>[Gallery where the VM image is located]</code></li> <li>Operating system state: <code>Generalized</code></li> <li>Target VM image definition: <code>[VM image name]</code></li> <li>Version number: <code>[VM image version number]</code><ul> <li>e.g. <code>0.0.2</code></li> </ul> </li> </ul> </li> <li> <p>Under the Review + create tab, click 'Create' and wait for the VM to be captured as a new VM image version (could take a few minutes).</p> </li> </ol>"},{"location":"build/#creating-a-user-interface","title":"Creating a user interface","text":""},{"location":"connect/","title":"Connecting to FoodPort","text":"<p>To develop applications for FoodPort, you need to be able to connect to the CFIA network and be able to connect to FoodPort using an SSH client (e.g. PuTTY, or Visual Studio Code with an SSH extension). You'll also need a username and an RSA private key file which can be obtained by contacting Adam Koziol (adam.koziol@inspection.gc.ca).</p>"},{"location":"connect/#using-a-terminal","title":"Using a terminal","text":"<p>With a private key file <code>id_rsa</code>:</p> <pre><code>ssh -i id_rsa [username]@10.148.57.4\n</code></pre>"},{"location":"connect/#using-vs-codes-remote-ssh-extension","title":"Using VS Code's Remote - SSH extension","text":"<ol> <li> <p>Install and enable VS Code's Remote - SSH extension.</p> </li> <li> <p>Click on the Remote Explorer icon in the toolbar on the left side of your VS Code window.</p> <p></p> </li> <li> <p>Add a new remote connection.</p> <p></p> </li> <li> <p>Enter the SSH connection command (e.g. <code>ssh -i id_rsa [username]@10.148.57.4</code>), remembering to specify the absolute path to <code>id_rsa</code> on your system.</p> <p></p> </li> <li> <p>Choose the SSH configuration file to update on your system.</p> <p></p> </li> </ol>"}]}